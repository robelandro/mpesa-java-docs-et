---
title: Documentation
---

## Initialization

Create an instance of the `Mpesa` class by providing the required credentials:

```java
Mpesa mpesa = new Mpesa("API_KEY", "API_SECRET");
```

## STK Push

| Parameter         | Type   | Description                             |
| ----------------- | ------ | --------------------------------------- |
| merchantRequestId | String | Unique ID for the transaction           |
| businessShortCode | String | The business short code                 |
| password          | String | Encrypted password                      |
| timestamp         | String | Transaction timestamp (YYYYMMDDHHmmss)  |
| transactionType   | String | Type of transaction                     |
| amount            | String | Amount to be transacted                 |
| partyA            | String | Phone number initiating the transaction |
| partyB            | String | Paybill or till number                  |
| phoneNumber       | String | Customer's phone number                 |
| transactionDesc   | String | Description of the transaction          |
| callBackUrl       | String | URL for the transaction callback        |
| accountReference  | String | Unique account reference                |
| referenceData     | List   | Additional reference data               |

Trigger an STK Push request using the following method:

```java
UssdPushRequest request = UssdPushRequest.builder()
        .merchantRequestId("Partner name some testing")
        .businessShortCode("1020")
        .password("ENCODED_PASSWORD")
        .timestamp("20240918055823")
        .transactionType("CustomerPayBillOnline")
        .amount("20")
        .partyA("251777890420")
        .partyB("1020")
        .phoneNumber("251777890420")
        .transactionDesc("Payment Reason")
        .callBackUrl("https://www.myservice.com/result")
        .accountReference("Partner Unique ID")
        .referenceData(List.of(new ReferenceData("ThirdPartyReference", "Ref-12345")))
        .build();
```

## PayOut

| Parameter                | Type   | Description                             |
| ------------------------ | ------ | --------------------------------------- |
| originatorConversationID | String | Unique ID for the transaction           |
| initiatorName            | String | Name of the initiator                   |
| securityCredential       | String | Encrypted password                      |
| commandID                | String | Type of transaction                     |
| partyA                   | String | Phone number initiating the transaction |
| partyB                   | String | Paybill or till number                  |
| amount                   | int    | Amount to be transacted                 |
| remarks                  | String | Description of the transaction          |
| occasion                 | String | Occasion of the transaction             |
| queueTimeOutURL          | String | URL for the transaction callback        |
| resultURL                | String | URL for the transaction callback        |

Process payouts using the `payOut` method:

```java
PayOutRequest request = PayOutRequest.builder()
        .originatorConversationID("Partner name some testing")
        .initiatorName("apitest")
        .securityCredential("ENCODED_CREDENTIAL")
        .commandID("BusinessPayment")
        .partyA("600982")
        .partyB("251700404709")
        .amount(10)
        .remarks("Pay to Customer")
        .occasion("PayOut")
        .queueTimeOutURL("https://www.myservice.com/result")
        .resultURL("https://www.myservice.com/result")
        .build();

try {
    SuccessResponse response = mpesa.payOut(request);
    System.out.println(response.getResponseDescription());
} catch (MpesaApiException | DataValidationException | IOException e) {
    System.out.println(e.getMessage());
}
```

## Transaction Status

| Parameter              | Type   | Description                             |
| ---------------------- | ------ | --------------------------------------- |
| initiator              | String | Name of the initiator                   |
| securityCredential     | String | Encrypted password                      |
| commandId              | String | Type of transaction                     |
| transactionId          | String | Unique ID for the transaction           |
| originalConversationId | String | Original conversation ID                |
| partyA                 | String | Phone number initiating the transaction |
| identifierType         | String | Type of identifier                      |
| resultUrl              | String | URL for the transaction callback        |
| queueTimeoutUrl        | String | URL for the transaction callback        |
| remarks                | String | Description of the transaction          |
| occasion               | String | Occasion of the transaction             |

Query the status of a transaction:

```java
TransactionStatusRequest request = TransactionStatusRequest.builder()
        .initiator("apitest")
        .securityCredential("ENCODED_CREDENTIAL")
        .commandId("TransactionStatusQuery")
        .transactionId("0")
        .originalConversationId("AG-20190826-0000777ab7d848b9e721")
        .partyA("1020")
        .identifierType("4")
        .resultUrl("https://www.myservice.com/result")
        .queueTimeoutUrl("https://www.myservice.com/result")
        .remarks("Trans Status")
        .occasion("Query trans status")
        .build();

try {
    SuccessResponse response = mpesa.transactionStatus(request);
    System.out.println(response.getResponseDescription());
} catch (IOException | MpesaApiException | DataValidationException e) {
    System.out.println(e.getMessage());
}
```

## Transaction Reversal

| Parameter                | Type   | Description                             |
| ------------------------ | ------ | --------------------------------------- |
| originatorConversationId | String | Unique ID for the transaction           |
| initiator                | String | Name of the initiator                   |
| securityCredential       | String | Encrypted password                      |
| commandId                | String | Type of transaction                     |
| transactionId            | String | Unique ID for the transaction           |
| amount                   | String | Amount to be transacted                 |
| receiverIdentifierType   | String | Type of identifier                      |
| receiverParty            | String | Phone number initiating the transaction |
| resultUrl                | String | URL for the transaction callback        |
| queueTimeOutUrl          | String | URL for the transaction callback        |
| remarks                  | String | Description of the transaction          |
| occasion                 | String | Occasion of the transaction             |

Reverse a transaction if needed:

```java
TransactionReversalRequest request = TransactionReversalRequest.builder()
        .originatorConversationId("Partner name -{{$guid}}")
        .initiator("apitest")
        .securityCredential("ENCODED_CREDENTIAL")
        .commandId("TransactionReversal")
        .transactionId(" ")
        .amount("200")
        .receiverIdentifierType("1")
        .receiverParty("444000")
        .resultUrl("https://www.myservice.com/result")
        .queueTimeOutUrl("https://www.myservice.com/result")
        .remarks("B2C Reversal")
        .occasion("Payout")
        .build();

try {
    SuccessResponse response = mpesa.transactionReversal(request);
    System.out.println(response.getResponseDescription());
} catch (IOException | MpesaApiException | DataValidationException e) {
    System.out.println(e.getMessage());
}
```

## Account Balance

| Parameter                | Type   | Description                             |
| ------------------------ | ------ | --------------------------------------- |
| originatorConversationID | String | Unique ID for the transaction           |
| initiator                | String | Name of the initiator                   |
| securityCredential       | String | Encrypted password                      |
| commandID                | String | Type of transaction                     |
| partyA                   | String | Phone number initiating the transaction |
| identifierType           | String | Type of identifier                      |
| remarks                  | String | Description of the transaction          |
| queueTimeOutURL          | String | URL for the transaction callback        |
| resultURL                | String | URL for the transaction callback        |

Check the balance of an account:

```java
AccountBalanceRequest request = AccountBalanceRequest.builder()
        .originatorConversationID("Partner name -{{$guid}}")
        .initiator("apitest")
        .securityCredential("ENCODED_CREDENTIAL")
        .commandID("AccountBalance")
        .partyA("1020")
        .identifierType("4")
        .remarks("Balance check")
        .queueTimeOutURL("https://www.myservice.com/result")
        .resultURL("https://www.myservice.com/result")
        .build();

try {
    SuccessResponse response = mpesa.accountBalance(request);
    System.out.println(response.getResponseCode());
} catch (DataValidationException | IOException | MpesaApiException e) {
    System.out.println(e.getMessage());
}
```

## C2B Payment Simulation

| Parameter     | Type   | Description                             |
| ------------- | ------ | --------------------------------------- |
| commandID     | String | Type of transaction                     |
| amount        | String | Amount to be transacted                 |
| msisdn        | String | Phone number initiating the transaction |
| billRefNumber | String | Reference number for the transaction    |
| shortCode     | String | Paybill or till number                  |

Simulate a customer-to-business payment:

```java
SimulateRequest request = SimulateRequest.builder()
        .commandID("CustomerPayBillOnline")
        .amount("110")
        .msisdn("251945628580")
        .billRefNumber("091091")
        .shortCode("443443")
        .build();

try {
    SimulateResponse response = mpesa.simulatePayment(request);
    System.out.println(response.getResponseCode());
} catch (DataValidationException | IOException | MpesaApiException e) {
    System.out.println(e.getMessage());
}
```
